---
title: "Shiny GUI Walkthrough"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{walkthrough}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.align = "center"
)

library(knitr)
```

```{r setup}
library(rems2aquachem)
```


## Updating Data

The first time you launch the Shiny App your data sources will likely be out of date.

```{r, echo = FALSE, out.width = "80%"}
include_graphics("out-of-date.png")
```

1. Click on **Update recent data (2yr)** to download the `rems` recent dataset. You will see a progress message in the lower right corner. If you look at the R console, you will see the progress bar advance.

```{r, echo = FALSE, out.width = "80%"}
include_graphics("update_progress_console.png")
```

2. Next, click on **Update historic data** to download the `rems` historic dataset. As above, you will see a progress message in the lower right corner and if you look at the R console, you will see the progress bar advance.

```{r, echo = FALSE, out.width = "80%"}
include_graphics("update_historical2.png")
```

> **Note**   
>
> - Together these datasets are ~ 6.5 GB  
> - You'll have to wait for both status to be green before you can proceed


## Selecting data

**EMS IDs**

In order to download EMS data, you'll need to know the EMS IDs for the sites in question. These are Alpha-Numeric with 7 digits, e.g., 1401030, 1401377, E292373

```{r, echo = FALSE, out.width = "40%"}
include_graphics("ems_ids.png")
```

Type the EMS IDs into the the "EMS IDs" field. For multiple IDs, separate them by commas. They can be plain, or surrounded by quotes (")

```{r, echo = FALSE, out.width = "40%"}
include_graphics("ems_ids2.png")
```

**Dates**

If you want the full date range, simply leave the range as is and click on **"Get and convert EMS data"**

If you want a particular date range, select the first and last dates you wish to include (this applies to the complete date range). Click on **"Get and convert EMS data"**.


```{r, echo = FALSE, out.width = "40%"}
include_graphics("dates.png")
```

### Previewing data

You can choose which columns to preview by selecting either "Relevant Columns" (default) or "All Columns". Relevant columns only show metadata, cations, anions and charge balance. **ALL data is downloaded, this only affects the preview**.

```{r, echo = FALSE, out.width = "40%"}
include_graphics("data_preview.png")
```

The results of your ID, date and data filtering will be available under the **Results** tab. 

You can scroll and sort through the data to ensure you have the data you wanted.

The `charage_balance` values will be highlighted in green (value ranges from -10% to 10%) or red (values < -10% or > 10%) to indicate possibly problematic samples


> **Note** This may take a few minutes, depending on the amount of data you have requested.


```{r, echo = FALSE, out.width = "100%"}
include_graphics("results_v2.png")
```


## Downloading data

If you are satisfied with the data, click on "Download to CSV" to download a comma-separate file (.csv) or click on "Download to Excel" to download a colour-coded Excel file of the data (.xlsx).

```{r, echo = FALSE, out.width = "100%"}
include_graphics("results2.png")
```


## Missing data

Not all EMS stations have data for all dates, or even any data at all. Be sure to check the "Data Messages" window on the **REM Status** tab for status messages regarding any missing data.

```{r, echo = FALSE, out.width = "80%"}
include_graphics("missing_data.png")
```

```{r, echo = FALSE, out.width = "80%"}
include_graphics("missing_data2.png")
```

## Plots

Plots can be previewed by clicking on the **Plots** tab.

Click on the radio button associated with the EMS ID of the site you wish to view. To download **ALL** plots (i.e. not just the ones you can see), click on the "Download All Plots" button. This will zip the individual plots and ask you where to save the file.

```{r, echo = FALSE, out.width = "80%"}
include_graphics("plots.png")
```


## FAQ

1. When in doubt, restart RStudio

2. If you run into errors right at the start, try updating your packages:

  ```{r, eval = FALSE}
  remotes::update_packages()
  ```

3. Remember that the output is optimized for AquaChem, not necessarily for other data analyses (i.e. the second row of the data frame is for units, which wouldn't work in R)

